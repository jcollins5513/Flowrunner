# Next Conversation Prompt

Continue work on **FlowRunner** — the AI-driven visual UI flow generator.

## Current Status

✅ **Phase 12.4: Flow Branching is COMPLETE:**
- ✅ Branch management utilities (`lib/flows/branching.ts`)
- ✅ Branch management API endpoints (GET, POST, PATCH, DELETE, MERGE)
- ✅ BranchEditor component for UI branch management
- ✅ Branch visualization in NavigationDiagram (labels and conditions on edges)
- ✅ Branch deletion and merging functionality
- ✅ Comprehensive test suite for branch utilities

✅ **Phase 13.1: Revision Tracking is COMPLETE:**
- ✅ Extended Revision model with full metadata (userId, description, assetReferences, patternMapping, screenState, parentRevisionId, isAutoGenerated)
- ✅ Comprehensive revision service (`lib/revisions/revision-service.ts`)
- ✅ Auto-create revisions on screen generation and edits
- ✅ Revision restoration and diff/comparison functionality
- ✅ Database migration applied

## Next Focus: Phase A - Ship Preparation (Make App Testable & Shippable)

The backend features are largely complete, but the UI is not fully connected. We need to make the app testable and shippable by connecting existing features into a working, end-to-end experience.

### Phase A: Ship Preparation

**Goal:** Connect all existing features into a working, testable application.

#### A.1 Core Navigation & Landing
- [ ] Create home page with navigation links
- [ ] Add navigation bar/header component
- [ ] Create routes: Home → Create Flow → Gallery → Library → Playground
- [ ] Add basic styling and layout consistency

#### A.2 Flow Creation UI
- [ ] Create "New Flow" page (`/flows/new`)
- [ ] Add form: flow name, description, prompt, domain
- [ ] Connect to flow creation API (`POST /api/flows`)
- [ ] Redirect to flow editor after creation

#### A.3 Flow Editor Page
- [ ] Create flow editor page (`/flows/[flowId]/edit`)
- [ ] Load existing flow with screens (use `GET /api/flows/[flowId]?includeScreens=true`)
- [ ] Integrate InteractiveScreen component (`components/flow/InteractiveScreen.tsx`)
- [ ] Connect screen generation (use existing `generateNextScreen` from `lib/flows/next-screen-generator.ts`)
- [ ] Integrate editing components (use existing editing components from `components/editing/`)
- [ ] Add save functionality
- [ ] Show navigation diagram (NavigationDiagram component already exists)
- [ ] Add tab switcher: Screens | Diagram | Settings

#### A.4 Connect Existing Pieces
- [ ] Wire flow playground (`app/flow-playground/page.tsx`) to save flows option
- [ ] Connect gallery page (`app/(dashboard)/gallery/page.tsx`) to flow editor
- [ ] Connect flow detail page (`app/(dashboard)/gallery/[flowId]/page.tsx`) to flow editor
- [ ] Ensure all API endpoints are accessible from UI
- [ ] Add error handling and loading states

#### A.5 Basic Testing Flow
- [ ] Test: Create flow → Generate screens → Edit screen → View diagram
- [ ] Test: Load existing flow → Edit → Save
- [ ] Test: Gallery → Open flow → Edit
- [ ] Verify all core features are accessible

**Technical Notes:**
- Focus on connecting existing backend features to UI
- Use existing components where possible
- Prioritize functionality over polish
- Goal is to make everything testable, not perfect

---

## Key Files / Locations

### Existing Components to Use:
- Flow Creation API: `app/api/flows/route.ts` (POST endpoint)
- Flow Editor Components: `components/flow/InteractiveScreen.tsx`
- Editing Components: `components/editing/` (EditableTitle, EditableSubtitle, PaletteEditor, etc.)
- Navigation Diagram: `components/flow/NavigationDiagram.tsx`
- Screen Generation: `lib/flows/next-screen-generator.ts` (`generateNextScreen`)
- Flow Engine: `lib/flows/engine.ts` (FlowEngine class)
- Flow Context: `lib/flows/flow-context.tsx` (FlowProvider, useFlow hook)

### Pages to Create/Update:
- Home Page: `app/page.tsx` (currently just title, needs navigation)
- Create Flow Page: `app/(dashboard)/flows/new/page.tsx` (new)
- Flow Editor Page: `app/(dashboard)/flows/[flowId]/edit/page.tsx` (new)
- Update Gallery: `app/(dashboard)/gallery/page.tsx` (already exists, needs editor links)

### API Endpoints Available:
- `GET /api/flows` - List flows
- `POST /api/flows` - Create flow
- `GET /api/flows/[flowId]` - Get flow with screens
- `POST /api/flows/[flowId]/screens` - Create screen
- `GET /api/flows/[flowId]/navigation` - Get navigation graph
- `POST /api/flows/[flowId]/navigation` - Add navigation path

---

## Principles / Constraints

- Use existing components where possible (don't reinvent)
- Connect existing backend APIs to UI
- Prioritize functionality over polish
- Make everything testable end-to-end
- Keep it simple - goal is to ship and test

---

## Completed Phases Summary

- ✅ Phase 12.1-12.2: Click-Through Interface & Next Screen Generation
- ✅ Phase 12.3: Navigation Diagram
- ✅ Phase 12.4: Flow Branching
- ✅ Phase 13.1: Revision Tracking

---

## Next Session Goals

1. Create home page with navigation
2. Create "New Flow" page
3. Create flow editor page that connects all existing pieces
4. Test end-to-end: Create → Generate → Edit → View Diagram → Save

This will make the app testable and shippable!
